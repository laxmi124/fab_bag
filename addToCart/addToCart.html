<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add to cart page</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      .cart-container {
        border: 2px solid red;
        padding: 5% 1%;
        margin: 0 4%;
        width: auto;
      }
      .cart-title {
        padding: 0 0 40px 0;
      }
      .cart-body {
        display: flex;
        padding: 0;
        margin: 0;
        width: auto;
        justify-content: space-between;
        
      }
      .cart-product-info{
          flex: 4;
      }
      .cart-value-and-buttons {
          flex: 2;
        background-color: #f7f7f7;
      }
      .cart-price-info {
        display: flex;
        justify-content: space-between;
        margin: 20px 1% 10px;
      }
      .cart-price-info> div{
          margin: 10px;
      }
      .update-cart-btn {
        background-color: #343434;
        color: white;
        text-align: center;
        padding: 10px 0;
        margin: 10px 10px 0 ;
        width: auto;
        border-radius: 4px;
      }
      .check-out-btn {
        background-color: #e5b95f;
        color: white;
        text-align: center;
        padding: 10px 0;
        margin: 20px 10px 20px;
        width: auto;
        border-radius: 4px;
      }
      a{
        text-decoration: none;
      }
      td{
        padding: 10px;
      }
      h1{
        font-weight: normal;
      }
    </style>
  </head>
  <body>
    <div class="main-addToCart">
      <div class="cart-container">
        <div class="cart-title"><h1>My Cart</h1></div>
        <div class="cart-body">
          <div class="cart-product-info">  
            <table>
              <thead>
                <tr>
                  <th>PRODUCT</th>
                  <th></th>
                  <th>QTY</th>
                  <th>PRICE</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
          <div class="cart-value-and-buttons">
            <div class="cart-price-info">
              <div>TOTAL PRICE :</div>
              <div>Rs. 1000</div>
            </div>
            <div class="update-cart-btn">UPDATE CART</div>
            <a href="../information/checkout.html">
              <div class="check-out-btn">CHECK OUT</div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </body>

  <script>
    function displayCart() {
      let count = 0   // count to check the no of ele with ele.quantity == 0, to show Your cart is empty!!
      let data = JSON.parse(localStorage.getItem("cart"))
      console.log(data);
      let tBody = document.querySelector("tbody")
      tBody.innerHTML = ""
      data.forEach(element => {
        if (element.quantity) {
          console.log(element);
          let tr = document.createElement("tr")
          let td1 = document.createElement("td")
          let img = document.createElement("img")
          img.src = element.img
          img.alt = element.subscription
          td1.appendChild(img)
          let td2 = document.createElement("td")
          let p = document.createElement("p")
          p.textContent = element.title
          td2.appendChild(p)
          let td3 = document.createElement("td")
          let input = document.createElement("input")
          input.style.textAlign = "center"
          input.type = "text"
          input.value = element.quantity
          td3.appendChild(input)
          let td4 = document.createElement("td")
          let amount = document.createElement("p")
          amount.textContent = `Rs. ${element.price * element.quantity}`
          td4.appendChild(amount)
          let td5 = document.createElement("td")
          td5.innerHTML = `<img
                      onclick="remove(this.name)"  
                      name=${element.subscription}
                      style="width: 15px"
                      src="http://cdn.onlinewebfonts.com/svg/img_439489.png"
                      alt=""
                    />` //used a imaginary aux attribute name in img above to pass the subscription detaial to 

          tr.append(td1,td2,td3,td4,td5)
          tBody.appendChild(tr)

        }
        else{
          count++
        }
      });
      if (count === data.length) {
        let msg = document.createElement("h1")
        msg.textContent = "your cart is empty!!"
        document.querySelector(".cart-body").innerHTML = msg.outerHTML
      }
    }
    displayCart();

    function remove(id) {
      console.log(id);
      let cart = JSON.parse(localStorage.getItem("cart"));
      cart.forEach(ele => {
        if (ele.subscription === id) {
          ele.quantity = 0;
        }
      });
      localStorage.setItem("cart", JSON.stringify(cart))
      displayCart()
    }

    document.querySelector(".update-cart-btn").addEventListener("click",updateCart)

    document.querySelector(".check-out-btn").addEventListener("click",updateCart)

    function updateCart() {
      let data = JSON.parse(localStorage.getItem("cart"))
      let table = document.querySelector("tbody")
      table.childNodes.forEach(tableRow => {
        data.forEach(item => {
          if (item.subscription == tableRow.childNodes[0].firstChild.alt) {
            if (+tableRow.childNodes[2].firstChild.value >= 0) {
              item.quantity = +tableRow.childNodes[2].firstChild.value
            }
          }
        });
        // console.log(tableRow.childNodes[0].firstChild.alt,tableRow.childNodes[2].firstChild.value);
      });
      console.log(data,"updatedCart after cliking updatecart");
      localStorage.setItem("cart", JSON.stringify(data))
      displayCart()
      // console.log(table.childNodes[0].childNodes[0].firstChild);
    }

  </script>

</html>
